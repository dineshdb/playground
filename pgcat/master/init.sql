CREATE USER repl_user WITH REPLICATION PASSWORD 'repl_pass';
CREATE USER readonly_user WITH PASSWORD 'readonly_pass';
GRANT CONNECT ON DATABASE mydb TO postgres;
GRANT CONNECT ON DATABASE mydb TO repl_user;
GRANT CONNECT ON DATABASE mydb TO readonly_user;
GRANT USAGE ON SCHEMA public TO readonly_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO readonly_user;
CREATE TABLE IF NOT EXISTS test_table(id serial PRIMARY KEY, x integer DEFAULT 0);
INSERT INTO test_table(x) VALUES(0) ON CONFLICT DO NOTHING;
